---
title: "Worked solutions to basic exercises"
author: "Carles Bret√≥"
output:
  html_document:
    toc: yes
    toc_depth: 4
bibliography: ../sbied.bib
csl: ../ecology.csl
---

[Licensed under the Creative Commons Attribution-NonCommercial license](http://creativecommons.org/licenses/by-nc/4.0/).
Please share and remix noncommercially, mentioning its origin.  
![CC-BY_NC](../graphics/cc-by-nc.png)


```{r,include=FALSE}
source("https://kingaa.github.io/sbied/stochsim/stochsim.R")
```

## Basic Exercise: Explore the SIR model

The simulated data seem to fail to capture different aspects of the data. In particular, the simulated data appear to peak substantially later (if at all) than the observed data. This in turn results in simulated valleys that arrive (again, if at all) much later. To attempt to simulate data for which the observed data is a more plausible realization, one could try increasing the force of infection.

```{r}
sims2 <- simulate(sir,params=c(Beta=2.5,gamma=1,rho=0.9,N=2600),
                 nsim=20,as.data.frame=TRUE,include.data=TRUE)

ggplot(sims2,mapping=aes(x=time,y=B,group=sim,color=sim=="data"))+
  geom_line()+guides(color=FALSE)
```

Increasing the force of infection improves in one direction but now the peak is too tall. To counteract this, one could try reducing the population size.

```{r}
sims3 <- simulate(sir,params=c(Beta=2.5,gamma=1,rho=0.9,N=1500),
                 nsim=20,as.data.frame=TRUE,include.data=TRUE)

ggplot(sims3,mapping=aes(x=time,y=B,group=sim,color=sim=="data"))+
  geom_line()+guides(color=FALSE)
```

And even perhaps increase the duration of immunity.

```{r}
sims4 <- simulate(sir,params=c(Beta=2.5,gamma=1.5,rho=0.9,N=1500),
                 nsim=20,as.data.frame=TRUE,include.data=TRUE)

ggplot(sims4,mapping=aes(x=time,y=B,group=sim,color=sim=="data"))+
  geom_line()+guides(color=FALSE)
```

## Basic Exercise: The SEIR model

Since the only element that needs to be changed is the `rprocess`, one can extend the existing `sir_step` Csnippet by adding a new compartment and updating the `pomp` object by replacing the SIR Cnisppet:

```{r rproc2}
sir_step <- Csnippet("
  double dN_SI = rbinom(S,1-exp(-Beta*I/N*dt));
  double dN_IR = rbinom(I,1-exp(-gamma*dt));
  S -= dN_SI;
  I += dN_SI - dN_IR;
  R += dN_IR;
  H += dN_IR;
")

sir_init <- Csnippet("
  S = N-1;
  I = 1;
  R = 0;
  H = 0;
")

pomp(sir,rprocess=euler.sim(sir_step,delta.t=1/6),initializer=sir_init,
     paramnames=c("Beta","gamma","N"),statenames=c("S","I","R","H")) -> sir
```

Modify the codes above to construct a pomp object containing the flu data and an SEIR model. Perform simulations as above and adjust parameters to get a sense of whether improvement is possible by including a latent period.


----------------------------

## [Back to Stochastic Simulation lesson](./stochsim.html)

----------------------------

## References
